## DAG无向图构造
dag是把一个句子使用图来表示，对一个句子中的每个字，到dict.txt中寻找成词的Index，构造成DAG。其中，jieba的词典如下：
```angular2
A座 3 n
A股 3 n
A型 3 n
A轮 3 n
AA制 3 n
AB型 3 n
```
数据结构为(词，词频，词性)  
如果要对“去北京大学玩”构造DAG，对每个字查dict.txt字典生成DAG：
```
{0 : [0], 1 : [1, 2, 4], 2 : [2], 3 : [3, 4], 4 : [4], 5 : [5]}
```
dag中，key表示每个字的索引，value=[]表示该字在dict中有成词的对应索引。  
例如DAG中{0:[0]} 这样一个简单的DAG, 就是表示0位置对应的是词, 就是说0~0,即”去”这个词 在dict.txt中是词条。DAG中{1:[1,2,4]}, 就是表示1位置开始, 在1,2,4位置都是词, 就是说1~1,1~2,1~4 即 “北”，“北京”，“北京大学”这三个词 在dict.txt对应文件的词库中。
构造DAG的代码见**get_DAG**方法。
最后动态规划求解最大概率路径。
## 最大路径计算问题
之前构建的DAG都是带权的，对在前缀词典中的词，权重就是词频。要求得是全局概率route = (w1,w2,w3,...,wn)，能够使得 ∑weight(wi) 最大。
### 动态规划问题
动规求解需要满足：
* 存在重复子问题  
对DAG：对于节点wi和其可能存在的多个后继节点wj和wk。  
```
任意通过Wi到达Wj的路径的权重 = 该路径通过Wi的路径权重 + Wj的权重，也即{Ri -> j} = {Ri + weight(j)}
任意通过Wi到达Wk的路径的权重 = 该路径通过Wi的路径权重 + Wk的权重，也即{Ri -> k} = {Ri + weight(k)}
```
存在重复计算到达wi的路径概率。
* 具备最优子结构  
对整个句子的最优路径Rmax，和一个末端节点Wx,对其存在的多个前驱Wi，Wj，Wk...，设到达Wi，Wj，Wk的最大路径分别是Rmaxi，Rmaxj，Rmaxk。
```
Rmax = max(Rmaxi,Rmaxj,Rmaxk,...) + weight(Wx)
```
问题转化为求解每个最优路径的最优解，组成的最优子结构，子结构里面的最优解是全局最优解的一部分。状态方程：
```
Rmax = max{(Rmaxi,Rmaxj,Rmaxk,...) + weight(Wx)}
```
函数是从句子的最后一个字N-1开始倒序遍历sentence每个字的index，计算sentence[idx~N-1]的概率对数得分。然后把概率对数得到最高的情况用(概率对数，词语最后的索引)的数据结构存储。
logtotal是所有词频的对数和。
ReFerence：
https://www.cnblogs.com/zhbzz2007/p/6084196.html